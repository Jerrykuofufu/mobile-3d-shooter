<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Gravity Courier Run</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7dd3fc">

<style>
:root{
  --bg:#eef6ff;
  --card:#ffffff;
  --ink:#111;
  --muted:#6b7280;
  --neon1:#a5f3fc;
  --neon2:#c7d2fe;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system;}
body{
  margin:0;
  background:linear-gradient(180deg,#eaf3ff,#f8fbff);
  color:var(--ink);
}
.wrap{max-width:900px;margin:auto;padding:16px;}
h1{font-size:34px;margin:6px 0 10px;}
.badge{
  display:inline-block;padding:6px 12px;
  border-radius:999px;background:#fff;
  border:1px dashed #c7d2fe;margin:4px 4px;
}
.panel{
  background:var(--card);
  border-radius:24px;
  padding:16px;
  box-shadow:
    0 0 0 2px rgba(255,255,255,.9),
    0 0 40px rgba(165,243,252,.7),
    inset 0 0 30px rgba(199,210,254,.4);
}
canvas{
  width:100%;
  height:auto;
  border-radius:18px;
  background:linear-gradient(180deg,#f8fbff,#eef6ff);
}
.stats{display:flex;gap:14px;flex-wrap:wrap;margin-top:8px;}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
button{
  padding:10px 14px;border-radius:14px;
  border:2px dashed #c7d2fe;
  background:#fff;font-weight:700;
}
button.primary{border-style:solid;border-color:#93c5fd;}
.small{font-size:13px;color:var(--muted);}
</style>
</head>

<body>
<div class="wrap">
  <h1>ğŸ›µ Gravity Courier Run</h1>

  <div class="badge">é»ä¸€ä¸‹ç¿»è½‰é‡åŠ› âœ¨</div>
  <div class="badge">æ‰‹æ©Ÿè¶…é †</div>
  <div class="badge">Combo è¶Šé«˜åŠ åˆ†è¶Šé¦™ ğŸ•</div>

  <div class="panel">
    <canvas id="game" width="800" height="240"></canvas>

    <div class="stats">
      <div>Score: <b id="score">0</b></div>
      <div>Best: <b id="best">0</b></div>
      <div>Combo: <b id="combo">0</b></div>
      <div>Speed: <b id="speed">1.0</b></div>
    </div>

    <div class="btns">
      <input id="name" placeholder="Name (â‰¤12)" maxlength="12">
      <button class="primary" id="restart">é‡æ–°é–‹å§‹</button>
      <button id="sfx">SFX: ON</button>
      <button id="bgm">BGM: ON</button>
    </div>

    <div class="small" style="margin-top:8px">
      æ“ä½œï¼šé»ä¸€ä¸‹ / ç©ºç™½éµ â†’ ç¿»è½‰é‡åŠ›ï¼ˆåœ°æ¿ â†” å¤©èŠ±æ¿ï¼‰<br>
      æç¤ºï¼šè²¼è‘—æŸ±å­é£›éï¼ˆåˆ¥æ’åˆ°ï¼‰æ›´å®¹æ˜“ç´¯ç© Combo
    </div>
  </div>
</div>

<script>
/* ========= Canvas ========= */
const c = game, ctx = c.getContext("2d");

/* ========= State ========= */
let y=180, vy=0, gravity=0.6, inverted=false;
let pipes=[], frame=0;
let score=0, combo=0, speed=1;
let running=false;
let best=+localStorage.best||0;
bestEl.textContent=best;

/* ========= Audio ========= */
let sfxOn=true,bgmOn=true;
const flipSfx=new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-jump-coin-216.wav");
const bgm=new Audio("https://assets.mixkit.co/music/preview/mixkit-chill-gaming-123.mp3");
bgm.loop=true;

/* ========= Controls ========= */
addEventListener("pointerdown", flip);
addEventListener("keydown", e=>{if(e.code==="Space")flip();});

function flip(){
  if(!running){start();return;}
  inverted=!inverted;
  vy= inverted ? -8 : 8;
  if(sfxOn) flipSfx.play();
}

/* ========= Game ========= */
function start(){
  running=true;
  pipes=[];
  score=combo=0;
  speed=1;
  inverted=false;
  y=180;vy=0;
  bgmOn && bgm.play();
}
restart.onclick=start;

function spawnPipe(){
  pipes.push({x:820,h:60+Math.random()*80});
}

function update(){
  if(!running)return;
  frame++;
  if(frame%110===0)spawnPipe(); // é–“è·å·²æ‹‰é–‹
  y+=vy;
  vy+= inverted ? -gravity : gravity;

  pipes.forEach(p=>p.x-=3*speed);
  pipes=pipes.filter(p=>p.x>-60);

  score++;
  if(score%200===0)speed+=0.05;

  if(y<20||y>220)gameOver();
}

function draw(){
  ctx.clearRect(0,0,800,240);
  ctx.fillStyle="#111";
  ctx.fillRect(80,y,22,22);

  ctx.fillStyle="#111";
  pipes.forEach(p=>{
    ctx.fillRect(p.x,0,24,p.h);
    ctx.fillRect(p.x,240-p.h,24,p.h);
    if(p.x<80&&p.x>50)combo++;
  });

  scoreEl.textContent=score;
  comboEl.textContent=combo;
  speedEl.textContent=speed.toFixed(1);
}

function gameOver(){
  running=false;
  bgm.pause();
  best=Math.max(best,score);
  localStorage.best=best;
  bestEl.textContent=best;
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ========= Toggles ========= */
sfx.onclick=()=>{sfxOn=!sfxOn;sfx.textContent=`SFX: ${sfxOn?"ON":"OFF"}`;}
bgm.onclick=()=>{bgmOn=!bgmOn;bgm.textContent=`BGM: ${bgmOn?"ON":"OFF"}`; if(!bgmOn)bgm.pause();}

/* ========= PWA ========= */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
